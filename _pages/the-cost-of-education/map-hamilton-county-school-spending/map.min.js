---
permalink: /projects/the-cost-of-education/map-hamilton-county-school-spending/map.min.js
---

!function(){"use strict";function f(a){function p(a){a.attr("d",m).attr("fill",function(a){return k(a.properties.quantile)}).attr("fill-opacity",1).attr("stroke","white").attr("stroke-width","1px").call(s).call(t)}function q(a){a.attr("class","location").attr("cx",function(a){return r(a).x}).attr("cy",function(a){return r(a).y}).attr("r",2).attr("fill","#252525")}function r(a){var b=l([a.properties.longitude,a.properties.latitude]);return{x:b[0],y:b[1]}}function s(a){a.on("mousemove",function(a){var b=d3.select("#tooltip").classed("hidden",!1);b.attr("pointer-events","none").style("left",d3.event.pageX+15+"px").style("top",d3.event.pageY-15+"px"),b.html(a.properties.school),d3.select(this).attr("stroke-width","2px")}).on("mouseout",function(){d3.select(this).attr("stroke-width","1px"),d3.select("#tooltip").classed("hidden",!0)})}function t(a){function g(){c.classed("hidden")||(c.classed("hidden",!0),c.selectAll(".chart").remove())}function h(a){d3.event.stopPropagation(),d3.event.preventDefault(),g(),c.classed("hidden",!1).style({left:a.offsetLeft+"px",top:a.offsetTop+"px",width:a.offsetWidth+"px"})}function i(a){var b=c.select("table"),d=b.selectAll("tr td:last-child");b.select("caption").html(a.school),d[0].forEach(function(b){var c,d=d3.select(b);switch(d.attr("class")){case"minority":case"poverty":case"special":case"ell":c=d3.format("%.0f")(a[d.attr("class")]);break;case"funding":c=d3.format("$,.0f")(a[d.attr("class")]);break;default:c=a[d.attr("class")]}d.html(c)})}function j(a){var b=[{name:"Elementary",value:7095},{name:"Middle",value:7198},{name:"High",value:6557}],d=[{name:a.school,value:a.funding},{name:"Hamilton County average",value:7234}];b.forEach(function(b){b.name==a.type&&(b.name+=" school average",d.push(b))});var e=c.append("div").attr("class","chart");e.html("Average spending per student"),f.top=16,f.bottom=32,f.left=160,f.right=0;var g=+document.querySelector(".chart").offsetWidth-f.width(),h=90,i=d3.scale.linear().domain([0,12e3]).range([0,g]),j=d3.scale.ordinal().domain(d.map(function(a){return a.name})).rangeRoundBands([0,h],.2),l=d3.svg.axis().scale(i).orient("bottom").tickFormat(d3.format("$,")).tickSize(-h,0,0).tickValues([6e3,8e3,1e4]),m=d3.select("div.chart").append("svg").attr("width",g+f.width()).attr("height",h+f.height()).append("g").attr("transform","translate("+f.left+","+f.top+")");m.append("g").attr("class","axis").call(l).attr("transform","translate(0,"+h+")");var n=m.selectAll("g.bar").data(d).enter().append("g").attr("class","bar").attr("transform",function(a){return"translate(0,"+j(a.name)+")"});n.append("rect").attr("x",i(0)).attr("y",0).attr("height",j.rangeBand()).attr("width",function(a){return i(a.value)}).attr("fill",k.range()[2]),n.append("text").attr("x",0).text(function(a){return a.name}),n.append("text").attr("x",function(a){return i(a.value)}).attr("fill","white").text(function(a){return d3.format("$,.0f")(a.value)}),n.selectAll("text").attr("y",j.rangeBand()/2).attr("dx",-5)}var c=d3.select("#modal"),e=c.selectAll(".close");a.on("click",function(a){h(b),i(a.properties),d||j(a.properties)}),e.on("click",function(){d3.event.stopPropagation(),d3.event.preventDefault(),g()})}function v(){var a=window.navigator.userAgent,b=a.indexOf("MSIE");return b>0?parseInt(a.substring(b+5,a.indexOf(".",b))):navigator.userAgent.match(/Trident\/7\./)?11:0}function w(){var a=+d3.select("#sliders #grade    input")[0][0].value,b=+d3.select("#sliders #funding  input")[0][0].value,c=+d3.select("#sliders #minority input")[0][0].value,d=+d3.select("#sliders #poverty  input")[0][0].value,e=+d3.select("#sliders #district input")[0][0].value;a=["elementary","middle","high"][a-1];var f=n.selectAll("g.school").data(j[a].features);f.exit().remove(),f.select("path").remove(),f.select("circle").remove(),f.enter().append("g").attr("class","school"),f.append("path").call(p).attr("fill-opacity",function(a){var i,f=a.properties,g=.3,h=1;switch(!0){case f.funding<=b:case f.minority<=c:case f.poverty<=d:i=g;break;default:i=h}return 0!=e&&f.district!=e&&(i=g),i}).attr("stroke",function(a){return 0==e?"white":a.properties.district==e?"#6d6e70":void 0}),f.append("circle").call(q),d3.select("#grade-output").html(a),d3.select("#funding-output").html(d3.format("$,")(b)),d3.select("#minority-output").html(d3.format("%.01f")(c)),d3.select("#poverty-output").html(d3.format("%.01f")(d)),d3.select("#district-output").html(function(){return["Countywide","In the 1st District","In the 2nd District","In the 3rd District","In the 4th District","In the 5th District","In the 6th District","In the 7th District","In the 8th District","In the 9th District"][e]})}var f={top:0,right:0,bottom:0,left:0,width:function(){return this.right+this.left},height:function(){return this.top+this.bottom}},g={width:1,height:1.05},h=function(){if(!a)var a=+b.offsetWidth;return a-f.width()}(),i=function(){var a=g.height/g.width;return Math.round(h*a-f.height())}();b.innerHTML="";var j={high:topojson.feature(e,e.objects.high),middle:topojson.feature(e,e.objects.middle),elementary:topojson.feature(e,e.objects.elementary)},k=d3.scale.ordinal().range(["rgb(236,231,242)","rgb(166,189,219)","rgb(54,144,192)","rgb(4,90,141)","rgb(8,68,89)"]).domain([1,2,3,4,5]),l=d3.geo.mercator().center(d3.geo.centroid(j.elementary)).translate([h/2,i/2]).scale(100*h).rotate([-.3,-.5]),m=d3.geo.path().projection(l),n=d3.select(b).append("svg").attr("width",h+f.width()).attr("height",i+f.height()).append("g").attr("transform","translate("+f.left+","+f.top+")"),o=n.selectAll("g.school").data(j.elementary.features).enter().append("g").attr("class","school");o.append("path").call(p),o.append("circle").call(q);(function(a,b){var c=36,e=d3.scale.ordinal().domain(b).rangeRoundBands([0,a]),f=n.append("g").attr("id","legend").attr("height",c).attr("width",a).attr("transform","translate(8,20)");f.append("text").attr("x",d?0:a/2).attr("text-anchor",d?"start":"middle").text("Per-student spending");var g=f.selectAll("g.key").data(b).enter().append("g").attr("class","key").attr("transform","translate(0,8)");g.append("rect").attr("fill",function(a){return a}).attr("x",function(a){return e(a)}).attr("y",16).attr("width",e.rangeBand()).attr("height",10),g.append("text").attr("x",function(a){return e(a)+e.rangeBand()/2}).attr("y",12).text(function(a,b){switch(b){case 0:return d?"\u201310%":"<\u201310%";case 2:return d?"Avg":"Average";case 4:return d?"+10%":">+10%";default:return""}})})(.33*h,k.range());v()?d3.select(c).selectAll("input").on("change",w):d3.select(c).selectAll("input").on("input",w)}function g(a){for(var b in a)+a[b]?a[b]=+a[b]:a[b]=a[b];return a}var e,a=document.querySelector("#container"),b=document.querySelector("#map"),c=document.querySelector("#sliders"),d=+(a.offsetWidth<=414);window.onresize=function(){f()},d3.json("school-zones.topo.json",function(a,b){if(a)throw a;e=b,d3.csv("data.csv",g,function(a,b){if(a)throw a;for(var c in e.objects){var d=e.objects[c].geometries;d.forEach(function(a){b.forEach(function(b){return a.properties.geoid==b.geoid?a.properties={school:b.school,longitude:b.longitude,latitude:b.latitude,funding:b.spending,minority:b.minority,poverty:b.economic_disadvantage,district:b.district,quantile:b.quantile,grades:b.grades,adm:b.adm,special:b.special_education,ell:b.ell,type:b.type}:void 0})})}new pym.Child({renderCallback:f})})})}();